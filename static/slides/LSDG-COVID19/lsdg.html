<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Forecasting COVID-19 daily cases using phone call data</title>
    <meta charset="utf-8" />
    <meta name="author" content="    Bahman Rostami-Tabar" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="slides-style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Forecasting COVID-19 daily cases using phone call data
## NHS Nottingham and Nottinghamshire
### <br> <br> Bahman Rostami-Tabar <br>

---





layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://bit.ly/2DyXoHb" target="_blank"&gt;&lt;b&gt;Cardiff Business School&lt;/b&gt;&lt;/a&gt; - Dr. Bahman Rostami-Tabar 
&lt;/span&gt;
&lt;/div&gt; 
---







## Outline

- Do we really need one more forecasting model for COVID-19? we have already many!
- What are the proposed models in the literature and their limitations?
- What do we propose and how it contributes to the literature?
- How the proposed model performs comparing to benchmarks?
- What are the limitations of the model and possible extensions?

---

## Outline

- .pink[Do we really need one more forecasting model for COVID-19?]
- What are the proposed models in the literature and their limitations?
- What do we propose and how it contributes to the literature?
- How the proposed model performs comparing to benchmarks?
- What are the limitations of the model and possible extensions?

---

class: middle

.hand[Lack of a rigorous method to forecast the number of confirmed cases at ground/local level.]

![](img/sergio.png)

---

### Why forecasting COVID-19 cases 

Decision makers at the local level need forecasts to: 

- inform general strategy; 
- adjust hospital bed capacity; 
- cancel/postpone non-urgent hospital operations; 
- redirect available medical resources to COVID-19 wards; 
- plan for extra capacity in body storage of mortuary services.


---

## Outline

- Do we really need one more forecasting model for COVID-19? we have already many!
- .pink[What are the proposed models in the literature and their limitations?]
- What do we propose and how it contributes to the literature?
- How the proposed model performs comparing to benchmarks?
- What are the limitations of the model and possible extensions?

---

## Models used to forecast COVID19 cases

- Statistical
- Machine learning
- Spatio-temporal
- Epidemiological 
- Agent based

---

## Some limitations observed in the literature

- Forecast accuracy of models is not systematically reported; 
- Forecast errors greatly vary; 
- In some studies it is unclear how forecasts are generated and evaluated;
- Most of the studies focus on point forecasts and ignore the uncertainty associated with them, which may lead to less effective decisions;
- Main focus has been on the global and national levels;
- use of phone call data has not been explored/reported.

---

## Outline

- Do we really need one more forecasting model for COVID-19? we have already many!
- What are the proposed models in the literature and their limitations?
- .pink[What do we propose and how it contributes to the literature?]
- How the proposed model performs comparing to benchmarks?
- What are the limitations of the model and possible extensions?

---

### Our contributions

- Propose a simple and interpretable multiple linear regression model;
- Examine the use of phone call data and provide evidence of their usefulness in forecasting daily confirmed cases;
- Provide probabilistic forecasts that quantify uncertainties in future confirmed cases; 
- Benchmark the accuracy of our model against five techniques including ARIMA, Exponential Smoothing State Space, Seasonal Naive, Prophet and a regression model without considering phone call data.

---

class: middle

### Steps of the forecasting process

![](img/flowchart.png)
---

.pull-left[
### Confirmwd cases, Nottingham
&lt;table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; date &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; confirmed_cases &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-19 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-23 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

```
##       date                     confirmed_cases 
##  Min.   :2020-03-18 00:00:00   Min.   :  2.00  
##  1st Qu.:2020-05-10 18:00:00   1st Qu.: 13.00  
##  Median :2020-07-03 12:00:00   Median : 31.00  
##  Mean   :2020-07-03 12:00:00   Mean   : 89.27  
##  3rd Qu.:2020-08-26 06:00:00   3rd Qu.: 58.00  
##  Max.   :2020-10-19 00:00:00   Max.   :923.00
```
]

.pull-right[
### NHS111 pathway, Nottingham
&lt;table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; date &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; nhs111_call &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 410 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-19 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 368 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 369 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 373 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 435 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2020-03-23 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 423 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

```
##       date                      nhs111_call    
##  Min.   :2020-03-18 00:00:00   Min.   : 14.00  
##  1st Qu.:2020-05-10 18:00:00   1st Qu.: 32.75  
##  Median :2020-07-03 12:00:00   Median : 63.00  
##  Mean   :2020-07-03 12:00:00   Mean   :100.93  
##  3rd Qu.:2020-08-26 06:00:00   3rd Qu.:135.50  
##  Max.   :2020-10-19 00:00:00   Max.   :435.00
```
]

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lsdg_files/figure-html/weekend-1.png" alt="Time series of daily confirmed cases"  /&gt;
&lt;p class="caption"&gt;Time series of daily confirmed cases&lt;/p&gt;
&lt;/div&gt;

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lsdg_files/figure-html/casesoverlap-1.png" alt="Time series of daily confirmed cases"  /&gt;
&lt;p class="caption"&gt;Time series of daily confirmed cases&lt;/p&gt;
&lt;/div&gt;

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lsdg_files/figure-html/casesoverlapless-1.png" alt="Time series of daily confirmed cases"  /&gt;
&lt;p class="caption"&gt;Time series of daily confirmed cases&lt;/p&gt;
&lt;/div&gt;

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lsdg_files/figure-html/acf-1.png" alt="Autocorrelation and Partial Autocorrelation of the time series of confirmed cases"  /&gt;
&lt;p class="caption"&gt;Autocorrelation and Partial Autocorrelation of the time series of confirmed cases&lt;/p&gt;
&lt;/div&gt;

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lsdg_files/figure-html/NHS111-1.png" alt="Time series of daily phone calls."  /&gt;
&lt;p class="caption"&gt;Time series of daily phone calls.&lt;/p&gt;
&lt;/div&gt;

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lsdg_files/figure-html/ccf-1.png" alt="Relationship between NHS111 calls and confirmed cases"  /&gt;
&lt;p class="caption"&gt;Relationship between NHS111 calls and confirmed cases&lt;/p&gt;
&lt;/div&gt;

---

.pull-left[
### Proposed model
`\begin{equation}
Y_t = \beta_0 + \beta_1 \text{NHS 111}_t+ \text{trend}_{t}+\\
\underbrace{\sum_{k=1}^{21} \beta_{k+1} \text{Y}_{t-k}}_{\text{AutoRegressive effect}}+\\ \underbrace{\sum_{k=1}^{26} \beta_{22+k} \text{NHS 111}_{t-k-4}}_{\text{NHS 111 lag effect}} + \\Weekend_t + \varepsilon_t 
\end{equation}`
]

.pull-right[
- `\(Y_t\)`: number of positive confirmed cases on day `\(t\)`.
- `\(NHS 111_{t}\)`: number of NHS 111 calls on day `\(t\)`.
- `\(trend_{t}\)`: local trend on day `\(t\)`.
- `\(Y_{t-k}\)`: number of positive confirmed cases on day `\(t-k\)`.
- `\(NHS 111_{t-k-4}\)`: NHS111 calls on day `\(t-k-4\)`.
- `\(Weekend_{t}\)`: for the weekend dummy; `\(Weekend_{t}\)` is `1` if `\(t\)` falls on a Weekend and `0` otherwise.
]

---

.hand[Forecast is generated for 21 days ahead]

&lt;img src="img/pexamplefct.PNG" width="70%" style="display: block; margin: auto;" /&gt;

---

## Outline

- Do we really need one more forecasting model for COVID-19? we have already many!
- What are the proposed models in the literature and their limitations?
- What do we propose and how it contributes to the literature?
- .pink[How the proposed model performs comparing to benchmarks?]
- What are the limitations of the model and possible extensions?

---

## Forecast accuracy evaluation

- Forecast horizon is 21 days
- `30%` of data is used to test the forecast accuracy

    - Time series cross validation with re-estimation is used

- Performance is evaluated using

    - 3 point forecasting metrics: `ME`(Mean Error), `MAE`(Mean Absolute Error) and `RMSE`(Root Mean Square Error)
    - Prediction interval accuracy using `Winkler` score for 95% coverage interval
    - Probabilistic forecast accuracy using `Percentile score` and Continuous Ranked Probability Score (`CRPS`)

---

## Point forecast accuracy

`\(e_{t} = y_{t} - \hat{y}_{t}\)`

`\begin{align*}
  \text{Mean Error: ME} &amp; = \text{mean}(e_{t}),\\
  \text{Mean absolute error: MAE} &amp; = \text{mean}(|e_{t}|),\\
  \text{Root mean squared error: RMSE} &amp; = \sqrt{\text{mean}(e_{t}^2)}.
\end{align*}`

---

## Winkler score


`\begin{equation}
W_{\alpha,t} = \begin{cases}
  (u_{\alpha,t} - \ell_{\alpha,t}) + \frac{2}{\alpha} (\ell_{\alpha,t} - y_t) &amp; \text{if } y_t &lt; \ell_{\alpha,t} \\
  (u_{\alpha,t} - \ell_{\alpha,t})   &amp; \text{if }  \ell_{\alpha,t} \le y_t \le u_{\alpha,t} \\
  (u_{\alpha,t} - \ell_{\alpha,t}) + \frac{2}{\alpha} (y_t - u_{\alpha,t}) &amp; \text{if } y_t &gt; u_{\alpha,t}.
  \end{cases}
\end{equation}`

---

## Percentile/Quantile score

`\begin{equation}
  L(q_{i,t}, y_t) =
    \begin{cases}
    (1 - i/100)(q_{i,t} - y_t) &amp; y_t &lt; q_{i,t} \\ 
    (i/100)(y_t - q_{i,t}) &amp; y_t \geq q_{i,t}.
    \end{cases}
\end{equation}`

---

class: middle

## Continuous Ranked Probability Score (CRPS)

&lt;img src="img/CRPS.png" width="263" style="display: block; margin: auto;" /&gt;

---

class: middle

.hand[Forecast accuracy summarised averaged across all horizons]


&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Forecast performance evaluation&lt;/caption&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="6"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Accuracy measture&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Model &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; ME &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; RMSE &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; MAE &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Winkler &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Percentile &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CRPS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Prophet &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 154.39 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 275.09 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 155.34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4463.44 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 73.08 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 145.58 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; SNaive &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 146.41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 273.67 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 153.87 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2628.72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 69.14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 137.07 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ETS &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 148.89 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 271.99 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 153.28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3548.38 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 139.93 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ARIMA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 134.99 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 259.98 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 144.84 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2942.25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65.34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 129.72 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MLR_W &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 117.52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 222.59 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 124.30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2295.61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.76 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 108.73 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; MLR_T &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;"&gt; 86.70 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;"&gt; 178.06 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;"&gt; 97.00 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;"&gt; 583.25 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;"&gt; 39.71 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;"&gt; 78.72 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

Point accuracy across forecast horizon

&lt;img src="lsdg_files/figure-html/pointh-1.png" style="display: block; margin: auto;" /&gt;

---

Forecast uncertainty of models across forecast horizon

&lt;img src="lsdg_files/figure-html/uncertainty-1.png" style="display: block; margin: auto;" /&gt;

## Outline

- Do we really need one more forecasting model for COVID-19? we have already many!
- What are the proposed models in the literature and their limitations?
- What do we propose and how it contributes to the literature?
- How the proposed model performs comparing to benchmarks?]
- .pink[What are the limitations of the model and possible extensions?]

---

## Limitations

- Access to more granular data such as age group, minority group, health condition, local regulations, knockdown, duration of knockdown, and so on. 
Further improvements of the proposed model can be achieved by incorporating additional information. 

- Another limitation of the study is that the dataset does not contain hospital information such as COVID-19 admission and bed occupancy. This information allows for translating the forecast of COVID-19 confirmed cases into hospital admissions and bed capacity. 

---

## Future study

.hand[Developing a forecasting model for COVID19 hospital admission]

- Using Apple &amp; Google mobility data
- NHS111 phone calls
- Confirmed cases based on age groups
- Historical data of COVID19 admission in 3 hospitals in Nottingham
- Additional information such as Lockdown and foodbankd data

---

.hand-large[This paper is fully reproducible written in RMarkdown]

---

.hand-large[thank you!]

- Full paper is available [here](https://www.bahmanrt.com/publication/203/) 

- Email [rostami-tabarb@cardiff.ac.uk](mailto:rostami-tabarb@cardiff.ac.uk)

- Website [www.bahmanrt.com](www.bahmanrt.com)

- Twitter [@Bahman_R_T](https://twitter.com/Bahman_R_T)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-light",
"highlightLines": true,
"countIncrementalSlides": true,
"ratio": "16:9",
"slideNumberFormat": "<div class=\"progress-bar-container\">   <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">   </div> </div>"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
